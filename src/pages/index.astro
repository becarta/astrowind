---
// List the supported language codes.
const supportedLangs = ['en', 'fr', 'es'];

// Default language
let chosenLang = 'en';

// Get the user's Accept-Language header from the incoming request.
const acceptLang = Astro.request.headers.get('accept-language');

if (acceptLang) {
  // The header may look like: "fr-CH,fr;q=0.9,en-US;q=0.8,en;q=0.7"
  // Extract the first language code and simplify (e.g., "fr-CH" becomes "fr")
  const preferredLang = acceptLang.split(',')[0].trim().split('-')[0];
  if (supportedLangs.includes(preferredLang)) {
    chosenLang = preferredLang;
  }
}

// Redirect to the language-specific version.
// For example, if chosenLang is 'fr', then redirect to /fr/
return Astro.redirect(`/${chosenLang}`, 302);
---